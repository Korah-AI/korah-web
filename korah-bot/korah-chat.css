/* ── Korah Chat Interface — korah-chat.css ── */

body { font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; overflow: hidden; height: 100vh; }

/* ── Scrollbar ── */
::-webkit-scrollbar { width: 5px }
::-webkit-scrollbar-track { background: transparent }
::-webkit-scrollbar-thumb { background: #5b21b6; border-radius: 3px }

/* ── CSS Variables ── */
[data-theme="dark"] {
    --bg:#06040f; --bg2:#0d0920; --bg3:#120c28;
    --sf:rgba(18,12,40,.7); --sf2:rgba(30,18,60,.6);
    --bd:rgba(139,92,246,.2); --bd2:rgba(139,92,246,.1);
    --tx:#f0eaff; --tx2:#a89dc0; --tx3:#6b5f88;
    --p4:#8b5cf6; --p5:#a78bfa; --ac:#f0abfc;
    --gold:#fbbf24; --grn:#34d399; --red:#f87171;
    --glow:rgba(139,92,246,.35);
    --nb:rgba(6,4,15,.85); --cb:rgba(15,9,35,.82);
    --cu:rgba(91,33,182,.25); --ca:rgba(18,12,40,.9);
    --mg:#22c55e; --my:#eab308; --mr:#ef4444;
    --sidebar-w: 260px;
}
[data-theme="light"] {
    --bg:#faf8ff; --bg2:#f3efff; --bg3:#ebe5ff;
    --sf:rgba(255,255,255,.85); --sf2:rgba(243,239,255,.9);
    --bd:rgba(109,40,217,.18); --bd2:rgba(109,40,217,.1);
    --tx:#1a0a3c; --tx2:#5a4a7a; --tx3:#9080aa;
    --p4:#8b5cf6; --p5:#7c3aed; --ac:#a21caf;
    --gold:#d97706; --grn:#059669; --red:#dc2626;
    --glow:rgba(109,40,217,.15);
    --nb:rgba(250,248,255,.9); --cb:rgba(255,255,255,.92);
    --cu:rgba(109,40,217,.12); --ca:rgba(243,239,255,.95);
    --mg:#16a34a; --my:#ca8a04; --mr:#dc2626;
    --sidebar-w: 260px;
}

/* ── Semantic helpers ── */
.bg-base  { background: var(--bg) }
.bg-base2 { background: var(--bg2) }
.bg-card  { background: var(--cb) }
.bg-sf    { background: var(--sf) }
.bg-sf2   { background: var(--sf2) }
.bd       { border-color: var(--bd) }
.bd2      { border-color: var(--bd2) }
.tx       { color: var(--tx) }
.tx2      { color: var(--tx2) }
.tx3      { color: var(--tx3) }
.tx-p4    { color: var(--p4) }
.tx-p5    { color: var(--p5) }
.tx-grn   { color: var(--grn) }
.tx-gold  { color: var(--gold) }
.tx-mg    { color: var(--mg) }
.tx-my    { color: var(--my) }
.tx-mr    { color: var(--mr) }

.grad-text {
    background: linear-gradient(135deg, var(--p4), var(--ac));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    filter: drop-shadow(0 0 24px var(--glow));
}
.grad-bg { background: linear-gradient(135deg, #5b21b6, var(--p4)) }

.glass    { backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px) }
.glass-sm { backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px) }

.shadow-glow    { box-shadow: 0 0 20px var(--glow) }
.shadow-glow-lg { box-shadow: 0 0 36px var(--glow) }

.t-theme { transition: background-color .4s, border-color .4s, color .4s }
.t-btn   { transition: transform .2s, box-shadow .2s, filter .2s, background-color .2s, opacity .2s }
.t-btn:hover { transform: translateY(-1px) }
.t-btn:active { transform: translateY(0) scale(.97) }

/* ── Layout ── */
body { display: flex; background: var(--bg) }

.sidebar {
    width: var(--sidebar-w);
    min-width: var(--sidebar-w);
    height: 100vh;
    display: flex;
    flex-direction: column;
    border-right: 1px solid var(--bd);
    padding: 20px 16px;
    gap: 4px;
    z-index: 100;
    transition: width .35s cubic-bezier(.23,1,.32,1), min-width .35s cubic-bezier(.23,1,.32,1), transform .35s cubic-bezier(.23,1,.32,1), opacity .35s;
    overflow: hidden;
}

.sidebar.collapsed {
    width: 0;
    min-width: 0;
    padding: 0;
    opacity: 0;
    pointer-events: none;
}

.sidebar-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
    flex-shrink: 0;
}

.logo-btn {
    transition: transform .3s cubic-bezier(.23,1,.32,1), box-shadow .3s;
    cursor: pointer;
    position: relative;
    overflow: hidden;
}
.logo-btn::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(255,255,255,.2), transparent);
}
.logo-btn:hover { transform: rotate(-5deg) scale(1.08); box-shadow: 0 0 36px var(--glow) }
.logo-letter { font-family: 'Playfair Display', serif; color: white; font-size: 18px; position: relative; z-index: 1; }

.new-chat-btn {
    font-size: 11px;
    padding: 7px 14px;
    border-radius: 20px;
    white-space: nowrap;
    flex-shrink: 0;
}
.new-chat-btn:hover { filter: brightness(1.15); transform: translateY(-1px); box-shadow: 0 0 20px var(--glow) }

.sidebar-section-label {
    font-size: 9px;
    font-weight: 700;
    letter-spacing: 2.5px;
    text-transform: uppercase;
    color: var(--tx3);
    padding: 0 6px;
    margin: 12px 0 6px;
    flex-shrink: 0;
}

.chat-history {
    display: flex;
    flex-direction: column;
    gap: 2px;
    overflow-y: auto;
    max-height: 200px;
}

.history-item {
    display: flex;
    align-items: center;
    gap: 9px;
    padding: 9px 10px;
    border-radius: 12px;
    border: none;
    background: transparent;
    cursor: pointer;
    color: var(--tx2);
    font-size: 12.5px;
    font-weight: 500;
    font-family: 'Plus Jakarta Sans', sans-serif;
    text-align: left;
    width: 100%;
    white-space: nowrap;
    overflow: hidden;
    position: relative;
}
.history-item:hover { background: var(--bd2); color: var(--tx) }
.history-item:hover .history-actions { opacity: 1; pointer-events: all }
.history-item.active { background: var(--cu); color: var(--p5); border: 1px solid var(--bd) }
.history-icon { font-size: 14px; flex-shrink: 0 }
.history-text { overflow: hidden; text-overflow: ellipsis; flex: 1 }
.history-actions {
    display: flex;
    gap: 4px;
    opacity: 0;
    pointer-events: none;
    transition: opacity .2s;
    flex-shrink: 0;
}
.history-action-btn {
    width: 22px;
    height: 22px;
    border-radius: 6px;
    border: none;
    background: transparent;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--tx3);
    padding: 0;
    transition: background .2s, color .2s;
}
.history-action-btn:hover { background: var(--cu); color: var(--p4) }
.history-action-btn.delete-btn:hover { color: var(--red); background: rgba(239,68,68,.08) }

.quick-tools {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 6px;
}

.quick-tool-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 10px;
    border-radius: 10px;
    border: 1px solid var(--bd2);
    background: var(--sf2);
    cursor: pointer;
    color: var(--tx2);
    font-size: 11px;
    font-weight: 600;
    font-family: 'Plus Jakarta Sans', sans-serif;
    white-space: nowrap;
}
.quick-tool-btn:hover { border-color: var(--p4); color: var(--p5); background: var(--cu) }

.sidebar-footer {
    margin-top: auto;
    padding-top: 16px;
    border-top: 1px solid var(--bd2);
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-shrink: 0;
}

.mood-indicator {
    display: flex;
    align-items: center;
    gap: 7px;
}

.theme-toggle-small {
    width: 32px;
    height: 32px;
    border-radius: 10px;
    border: 1px solid var(--bd);
    background: var(--sf2);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    flex-shrink: 0;
}
.theme-toggle-small:hover { border-color: var(--p4); background: var(--cu) }

/* ── Main content ── */
.main-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow: hidden;
    min-width: 0;
}

/* ── Top bar ── */
.chat-topbar {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 0 20px;
    height: 60px;
    border-bottom: 1px solid var(--bd);
    flex-shrink: 0;
    z-index: 50;
}

.sidebar-toggle-btn {
    width: 36px;
    height: 36px;
    border-radius: 10px;
    border: 1px solid var(--bd2);
    background: transparent;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}
.sidebar-toggle-btn:hover { border-color: var(--p4); color: var(--p4); background: var(--cu) }

.chat-title-area {
    flex: 1;
    display: flex;
    align-items: center;
    gap: 8px;
    overflow: hidden;
}

.korah-status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--grn);
    box-shadow: 0 0 8px var(--grn);
    flex-shrink: 0;
    animation: pulse-dot 2s ease-in-out infinite;
}

@keyframes pulse-dot {
    0%, 100% { opacity: 1; transform: scale(1) }
    50% { opacity: .7; transform: scale(.85) }
}

.topbar-actions {
    display: flex;
    align-items: center;
    gap: 6px;
    flex-shrink: 0;
}

.topbar-btn {
    width: 34px;
    height: 34px;
    border-radius: 9px;
    border: 1px solid var(--bd2);
    background: transparent;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
}
.topbar-btn:hover { border-color: var(--p4); color: var(--p4); background: var(--cu) }

/* ── Mode Selector ── */
.mode-selector-wrapper {
    position: relative;
    flex-shrink: 0;
}
.mode-selector-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 7px 12px;
    border-radius: 10px;
    border: 1px solid var(--bd);
    background: var(--sf2);
    cursor: pointer;
    font-size: 13px;
    font-weight: 600;
    color: var(--tx);
    font-family: 'Plus Jakarta Sans', sans-serif;
}
.mode-selector-btn:hover { border-color: var(--p4); background: var(--cu) }
.mode-icon { font-size: 16px; line-height: 1 }
.mode-name { white-space: nowrap }
.mode-dropdown {
    position: absolute;
    top: calc(100% + 8px);
    right: 0;
    min-width: 280px;
    background: var(--cb);
    border: 1px solid var(--bd);
    border-radius: 14px;
    padding: 8px;
    display: none;
    flex-direction: column;
    gap: 4px;
    box-shadow: 0 8px 24px rgba(0,0,0,.3);
    z-index: 100;
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
}
.mode-dropdown.show { display: flex; animation: dropIn .2s ease both }
@keyframes dropIn {
    from { opacity: 0; transform: translateY(-8px) }
    to { opacity: 1; transform: translateY(0) }
}
.mode-option {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 12px;
    border-radius: 10px;
    cursor: pointer;
    transition: background .2s, transform .15s;
}
.mode-option:hover { background: var(--cu); transform: translateX(2px) }
.mode-option-icon { font-size: 20px; flex-shrink: 0 }
.mode-option-info { flex: 1 }
.mode-option-name {
    font-size: 13px;
    font-weight: 600;
    color: var(--tx);
    margin-bottom: 2px;
}
.mode-option-desc {
    font-size: 11px;
    color: var(--tx3);
    line-height: 1.3;
}

/* ── Chat body ── */
.chat-body {
    flex: 1;
    overflow-y: auto;
    padding: 24px 20px;
    display: flex;
    flex-direction: column;
    scrollbar-width: thin;
}
.chat-body::-webkit-scrollbar { width: 4px }
.chat-body::-webkit-scrollbar-thumb { background: var(--bd); border-radius: 2px }

#messages-container {
    max-width: 720px;
    width: 100%;
    margin: 0 auto;
    flex: 1;
    display: flex;
    flex-direction: column;
}

/* ── Welcome screen ── */
.welcome-screen {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    flex: 1;
    padding: 40px 20px;
    gap: 16px;
    animation: fadeUp .6s ease both;
}

@keyframes fadeUp {
    from { opacity: 0; transform: translateY(20px) }
    to   { opacity: 1; transform: none }
}

.welcome-mascot {
    position: relative;
    margin-bottom: 8px;
}

.mascot-avatar {
    width: 72px;
    height: 72px;
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    z-index: 1;
}
.mascot-letter {
    font-family: 'Playfair Display', serif;
    font-size: 32px;
    font-weight: 900;
    color: white;
}

.mascot-ring {
    position: absolute;
    inset: -8px;
    border-radius: 26px;
    border: 2px solid var(--p4);
    opacity: .4;
    animation: ring-pulse 2.5s ease-in-out infinite;
}

@keyframes ring-pulse {
    0%, 100% { opacity: .4; transform: scale(1) }
    50% { opacity: .15; transform: scale(1.06) }
}

.suggestion-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    width: 100%;
    max-width: 480px;
    margin-top: 8px;
}

.suggestion-chip {
    padding: 12px 14px;
    border-radius: 14px;
    border: 1px solid var(--bd);
    background: var(--sf2);
    cursor: pointer;
    color: var(--tx2);
    font-size: 12px;
    font-weight: 500;
    font-family: 'Plus Jakarta Sans', sans-serif;
    text-align: left;
    line-height: 1.4;
    transition: border-color .2s, color .2s, background .2s, transform .2s;
}
.suggestion-chip:hover { border-color: var(--p4); color: var(--tx); background: var(--cu); transform: translateY(-2px) }

.mood-picker-mini {
    margin-top: 8px;
}

.mood-row {
    display: flex;
    gap: 8px;
}

.mood-mini {
    padding: 8px 14px;
    border-radius: 20px;
    border: 1.5px solid var(--bd);
    background: var(--sf2);
    cursor: pointer;
    font-size: 12px;
    font-weight: 600;
    font-family: 'Plus Jakarta Sans', sans-serif;
    color: var(--tx2);
    transition: all .2s;
    white-space: nowrap;
}
.mood-mini:hover { transform: translateY(-1px) }
.mood-mini.gm { border-color: var(--mg); }
.mood-mini.ym { border-color: var(--my); }
.mood-mini.rm { border-color: var(--mr); }
.mood-mini.gm.active { background: rgba(34,197,94,.12); color: var(--mg) }
.mood-mini.ym.active { background: rgba(234,179,8,.12); color: var(--my) }
.mood-mini.rm.active { background: rgba(239,68,68,.12); color: var(--mr) }

/* ── Messages ── */
#messages-list {
    display: flex;
    flex-direction: column;
    gap: 16px;
    padding-top: 8px;
}

.msg-row {
    display: flex;
    gap: 12px;
    animation: msgIn .4s cubic-bezier(.23,1,.32,1) both;
}

@keyframes msgIn {
    from { opacity: 0; transform: translateY(12px) }
    to   { opacity: 1; transform: none }
}

.msg-row.user { flex-direction: row-reverse }

.msg-avatar {
    width: 32px;
    height: 32px;
    border-radius: 10px;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 13px;
    font-weight: 800;
    font-family: 'Playfair Display', serif;
    align-self: flex-end;
}
.msg-avatar.korah-av {
    background: linear-gradient(135deg, #5b21b6, var(--p4));
    color: white;
    box-shadow: 0 0 14px var(--glow);
}
.msg-avatar.user-av {
    background: var(--sf2);
    border: 1px solid var(--bd);
    color: var(--tx2);
    font-size: 14px;
}

.msg-bubble {
    max-width: 75%;
    padding: 12px 16px;
    border-radius: 18px;
    font-size: 13.5px;
    line-height: 1.65;
    border: 1px solid var(--bd);
}

.msg-bubble.korah {
    background: var(--ca);
    border-radius: 18px 18px 18px 4px;
}
.msg-bubble.user {
    background: var(--cu);
    border-radius: 18px 18px 4px 18px;
    color: var(--tx);
}

.msg-label {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: var(--p4);
    margin-bottom: 5px;
}
.msg-label-dot {
    width: 5px;
    height: 5px;
    border-radius: 50%;
    background: var(--p4);
    animation: pulse-dot 2s ease-in-out infinite;
}

/* Markdown-ish styling inside korah bubbles */
.msg-bubble.korah strong { color: var(--p5); font-weight: 700 }
.msg-bubble.korah em { color: var(--ac); font-style: italic }
.msg-bubble.korah code {
    background: rgba(139,92,246,.15);
    color: var(--p5);
    padding: 1px 6px;
    border-radius: 5px;
    font-size: 12px;
    font-family: monospace;
}
.msg-bubble.korah ul, .msg-bubble.korah ol {
    margin: 8px 0;
    padding-left: 20px;
    display: flex;
    flex-direction: column;
    gap: 4px;
}
.msg-bubble.korah li { line-height: 1.5 }
.msg-bubble.korah h3 {
    font-family: 'Playfair Display', serif;
    font-weight: 700;
    font-size: 15px;
    color: var(--tx);
    margin: 10px 0 4px;
}
.msg-bubble.korah p { margin: 4px 0 }
.msg-bubble.korah .flashcard-set {
    display: flex;
    flex-direction: column;
    gap: 6px;
    margin-top: 10px;
}
.msg-bubble.korah .fc-item {
    background: rgba(139,92,246,.08);
    border: 1px solid var(--bd2);
    border-radius: 10px;
    padding: 9px 12px;
    font-size: 12.5px;
}
.msg-bubble.korah .fc-q { color: var(--p5); font-weight: 600; margin-bottom: 3px }
.msg-bubble.korah .fc-a { color: var(--tx2) }

/* ── Typing indicator ── */
.typing-bar {
    max-width: 720px;
    width: 100%;
    margin: 0 auto;
    padding: 0 0 8px;
    display: flex;
    gap: 12px;
}
.typing-bar.hidden { display: none }
.typing-bubble {
    padding: 12px 16px;
    border-radius: 18px 18px 18px 4px;
    min-width: 70px;
}
.typing-dots {
    display: flex;
    gap: 5px;
    align-items: center;
    height: 16px;
}
.typing-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--p4);
    animation: tbounce .8s ease-in-out infinite;
}
@keyframes tbounce {
    0%, 80%, 100% { transform: translateY(0) }
    40% { transform: translateY(-6px) }
}

/* ── Input area ── */
.chat-input-area {
    border-top: 1px solid var(--bd);
    padding: 14px 20px 10px;
    flex-shrink: 0;
}

.input-wrapper {
    display: flex;
    align-items: flex-end;
    gap: 10px;
    background: var(--sf2);
    border: 1.5px solid var(--bd);
    border-radius: 18px;
    padding: 10px 14px;
    transition: border-color .2s, box-shadow .2s;
}
.input-wrapper:focus-within {
    border-color: var(--p4);
    box-shadow: 0 0 0 3px rgba(139,92,246,.12);
}

.input-tools {
    display: flex;
    align-items: center;
    gap: 4px;
    flex-shrink: 0;
}

.input-tool-btn {
    width: 28px;
    height: 28px;
    border-radius: 8px;
    border: none;
    background: transparent;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 13px;
}
.input-tool-btn:hover { background: var(--cu); color: var(--p4) }

.chat-textarea {
    flex: 1;
    border: none;
    outline: none;
    resize: none;
    font-family: 'Plus Jakarta Sans', sans-serif;
    font-size: 13.5px;
    line-height: 1.5;
    max-height: 160px;
    overflow-y: auto;
    scrollbar-width: none;
}
.chat-textarea::placeholder { color: var(--tx3) }
.chat-textarea::-webkit-scrollbar { display: none }

.send-btn {
    width: 36px;
    height: 36px;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    flex-shrink: 0;
    box-shadow: 0 0 14px var(--glow);
}
.send-btn:hover { filter: brightness(1.15); transform: scale(1.06) }
.send-btn:disabled { opacity: .4; cursor: not-allowed; transform: none }

.input-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 8px;
    padding: 0 2px;
}

/* ── Background canvas ── */
#bg-canvas { background: var(--bg) }

/* ── Scrollbar in sidebar ── */
.chat-history::-webkit-scrollbar { width: 3px }
.chat-history::-webkit-scrollbar-thumb { background: var(--bd); border-radius: 2px }

/* ── Responsive ── */
@media (max-width: 640px) {
    .sidebar { position: fixed; left: 0; top: 0; bottom: 0; z-index: 200; }
    .sidebar.collapsed { transform: translateX(-100%); width: var(--sidebar-w); min-width: var(--sidebar-w); opacity: 0 }
    .suggestion-grid { grid-template-columns: 1fr }
    .mood-row { flex-wrap: wrap }
}

/* ── Streaming cursor ── */
.streaming-cursor::after {
    content: '▋';
    color: var(--p4);
    animation: blink .7s step-end infinite;
    margin-left: 1px;
}
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0} }

/* ── Error message ── */
.msg-bubble.error {
    background: rgba(239,68,68,.08);
    border-color: rgba(239,68,68,.25);
    color: var(--red);
}
