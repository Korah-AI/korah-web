<!DOCTYPE html>
<html lang="en" x-data="{ theme: localStorage.getItem('korah_theme') || 'dark' }" :data-theme="theme" x-cloak>
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Korah AI â€” Chat</title>

<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet"/>
<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="korah-chat.css"/>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css"/>
</head>

<body class="bg-base tx">

<canvas id="bg-canvas" class="fixed inset-0 z-0 pointer-events-none opacity-40"></canvas>

<!-- â•â•â• SIDEBAR â•â•â• -->
<aside id="sidebar" class="sidebar bg-sf glass t-theme">
  <div class="sidebar-header">
    <a href="index.html" class="flex items-center gap-2.5 no-underline">
      <div class="w-10 h-10 rounded-xl grad-bg flex items-center justify-center font-display text-xl font-black text-white shadow-glow logo-btn">
        <span class="logo-letter">
          <img src="logo.png" alt="Korah"/>
        </span>
      </div>
      <div class="flex flex-col leading-tight">
        <span class="font-display text-[19px] font-bold tx">Korah</span>
        <span class="text-[9px] font-semibold tracking-[2.5px] uppercase tx-p4">Beta Â· Study AI</span>
      </div>
    </a>
    <button id="new-chat-btn" class="new-chat-btn grad-bg text-white text-xs font-bold px-4 py-2 rounded-full border-none cursor-pointer shadow-glow t-btn">
      + New Chat
    </button>
  </div>

  <nav class="sidebar-nav">
    <a href="index.html" class="sidebar-nav-link active t-btn">ğŸ’¬ Chat</a>
    <a href="study/feed.html" class="sidebar-nav-link t-btn">ğŸ“š Study Feed</a>
  </nav>

  <div class="sidebar-section-label">Recent Chats</div>
  <div id="chat-history" class="chat-history">
    <button class="history-item active t-btn" data-session="current">
      <span class="history-icon">ğŸ“š</span>
      <span class="history-text">Photosynthesis Study Guide</span>
    </button>
    <button class="history-item t-btn" data-session="1">
      <span class="history-icon">ğŸ§®</span>
      <span class="history-text">Calculus Flashcards</span>
    </button>
    <button class="history-item t-btn" data-session="2">
      <span class="history-icon">âš—ï¸</span>
      <span class="history-text">Chemistry Practice Test</span>
    </button>
    <button class="history-item t-btn" data-session="3">
      <span class="history-icon">ğŸ“</span>
      <span class="history-text">Essay Outline â€” WWII</span>
    </button>
    <button class="history-item t-btn" data-session="4">
      <span class="history-icon">ğŸ”¢</span>
      <span class="history-text">Statistics Review</span>
    </button>
  </div>

  <div class="sidebar-section-label mt-4">Recent Study Items</div>
  <div id="study-items-history" class="chat-history study-items-history">
    <!-- Populated by JS from localStorage -->
  </div>

  <div class="sidebar-footer">
    <div class="mood-indicator" id="sidebar-mood">
      <span class="mood-dot" id="mood-dot">ğŸŸ¢</span>
      <span class="text-xs tx2 font-medium">Full Focus Mode</span>
    </div>
    <div class="sidebar-footer-actions">
      <button id="settings-btn" class="theme-toggle-small t-btn" title="Settings">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="3"/>
          <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
        </svg>
      </button>
      <button @click="theme = theme === 'dark' ? 'light' : 'dark'; localStorage.setItem('korah_theme', theme)" class="theme-toggle-small t-btn" title="Toggle theme">
        <svg x-show="theme==='light'" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor" style="color:var(--p5)">
          <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"/>
        </svg>
        <svg x-show="theme==='dark'" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color:var(--p4)">
          <circle cx="12" cy="12" r="5"/>
          <line x1="12" y1="1" x2="12" y2="3"/>
          <line x1="12" y1="21" x2="12" y2="23"/>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
          <line x1="1" y1="12" x2="3" y2="12"/>
          <line x1="21" y1="12" x2="23" y2="12"/>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
        </svg>
      </button>
    </div>
  </div>
</aside>

<!-- â•â•â• MAIN CHAT AREA â•â•â• -->
<main id="main-content" class="main-content">

  <!-- Top bar -->
  <header class="chat-topbar bg-sf glass-sm t-theme bd">
    <button id="sidebar-toggle" class="sidebar-toggle-btn t-btn tx2" aria-label="Toggle sidebar">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/>
      </svg>
    </button>

    <div class="chat-title-area">
      <div class="korah-status-dot"></div>
      <span class="font-semibold tx text-sm" id="chat-title">Photosynthesis Study Guide</span>
    </div>

    <div class="mode-selector-wrapper">
      <button class="mode-selector-btn t-btn" id="mode-selector-btn" title="Change subject mode">
        <span class="mode-icon" id="mode-icon">âš›ï¸</span>
        <span class="mode-name" id="mode-name">Physics</span>
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="6 9 12 15 18 9"/>
        </svg>
      </button>
      <div class="mode-dropdown" id="mode-dropdown">
        <div class="mode-option" data-mode="general">
          <span class="mode-option-icon">âœ¨</span>
          <div class="mode-option-info">
            <div class="mode-option-name">General Mode</div>
            <div class="mode-option-desc">Versatile AI study companion</div>
          </div>
        </div>
        <div class="mode-option" data-mode="math">
          <span class="mode-option-icon">ğŸ§®</span>
          <div class="mode-option-info">
            <div class="mode-option-name">Math Mode</div>
            <div class="mode-option-desc">Step-by-step problem solving</div>
          </div>
        </div>
        <div class="mode-option" data-mode="physics">
          <span class="mode-option-icon">âš›ï¸</span>
          <div class="mode-option-info">
            <div class="mode-option-name">Physics Mode</div>
            <div class="mode-option-desc">Conceptual explanations & formulas</div>
          </div>
        </div>
        <div class="mode-option" data-mode="chemistry">
          <span class="mode-option-icon">âš—ï¸</span>
          <div class="mode-option-info">
            <div class="mode-option-name">Chemistry Mode</div>
            <div class="mode-option-desc">Reactions & molecular structures</div>
          </div>
        </div>
        <div class="mode-option" data-mode="biology">
          <span class="mode-option-icon">ğŸ§¬</span>
          <div class="mode-option-info">
            <div class="mode-option-name">Biology Mode</div>
            <div class="mode-option-desc">Life processes & terminology</div>
          </div>
        </div>
        <div class="mode-option" data-mode="history">
          <span class="mode-option-icon">ğŸ“œ</span>
          <div class="mode-option-info">
            <div class="mode-option-name">History Mode</div>
            <div class="mode-option-desc">Context & cause-effect analysis</div>
          </div>
        </div>
        <div class="mode-option" data-mode="literature">
          <span class="mode-option-icon">ğŸ“š</span>
          <div class="mode-option-info">
            <div class="mode-option-name">Literature Mode</div>
            <div class="mode-option-desc">Analysis & interpretation</div>
          </div>
        </div>
      </div>
    </div>

    <div class="topbar-actions">
      <button class="topbar-btn t-btn tx2" id="clear-chat-btn" title="Clear chat">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="3,6 5,6 21,6"/><path d="M19,6l-1,14a2,2,0,0,1-2,2H8a2,2,0,0,1-2-2L5,6"/><path d="M10,11v6M14,11v6"/><path d="M9,6V4a1,1,0,0,1,1-1h4a1,1,0,0,1,1,1v2"/>
        </svg>
      </button>
      <button class="topbar-btn t-btn tx2" title="Export chat">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21,15v4a2,2,0,0,1-2,2H5a2,2,0,0,1-2-2v-4"/><polyline points="7,10 12,15 17,10"/><line x1="12" y1="15" x2="12" y2="3"/>
        </svg>
      </button>
    </div>
  </header>

  <!-- Chat messages -->
  <div id="chat-body" class="chat-body">
    <div id="messages-container">

      <!-- Welcome state -->
      <div id="welcome-screen" class="welcome-screen">
        <div class="welcome-mascot">
          <div class="mascot-ring"></div>
          <div class="mascot-avatar grad-bg shadow-glow-lg">
            <span class="mascot-letter">
              <img src="logo.png" alt="K" class="w-90 h-90 object-contain"/>
            </span>
          </div>
        </div>
        
        <div class="welcome-mode-badge">
          <span class="welcome-mode-dot"></span>
          <span class="welcome-mode-text" id="welcome-mode-name">General Mode</span>
        </div>

        <h2 class="font-display text-3xl font-black tx mb-1">Hey, I'm Korah âœ¨</h2>
        <p class="tx2 text-sm leading-relaxed text-center max-w-sm mb-4">Your AI study companion. Choose a mode below or tell me what you're working on.</p>

        <div class="mode-pills" id="mode-pills-container">
          <!-- Populated by JS -->
        </div>

        <div class="suggestion-grid mt-6">
          <button class="suggestion-chip t-btn" data-prompt="Generate flashcards for photosynthesis">
            ğŸƒ Make flashcards for photosynthesis
          </button>
          <button class="suggestion-chip t-btn" data-prompt="I have a test tomorrow and I'm stressed. What should I study first?">
            ğŸ˜° I have a test tomorrow, help me prioritize
          </button>
          <button class="suggestion-chip t-btn" data-prompt="Create a study guide for Chapter 5 on cellular respiration">
            ğŸ“– Study guide for cellular respiration
          </button>
          <button class="suggestion-chip t-btn" data-prompt="Give me a 10-question practice test on World War II">
            ğŸ¯ Practice test on World War II
          </button>
        </div>
      </div>

      <!-- Messages will appear here -->
      <div id="messages-list"></div>
    </div>
  </div>

  <!-- Typing indicator (hidden by default) -->
  <div id="typing-indicator" class="typing-bar hidden">
    <div class="typing-bubble bg-card border bd t-theme">
      <div class="flex items-center gap-1.5 text-[11px] font-bold tracking-[1px] tx-p4 uppercase mb-1.5">
        <span class="w-1.5 h-1.5 rounded-full bg-p4 animate-pulse"></span>Korah AI
      </div>
      <div class="typing-dots">
        <span class="typing-dot"></span>
        <span class="typing-dot" style="animation-delay:.2s"></span>
        <span class="typing-dot" style="animation-delay:.4s"></span>
      </div>
    </div>
  </div>

  <!-- Suggestion bar -->
  <div id="suggestion-bar" class="suggestion-bar"></div>

  <!-- Input area -->
  <div class="chat-input-area bg-sf glass t-theme bd">
    <div class="input-wrapper">
      <div class="input-tools">
        <button class="input-tool-btn t-btn tx3" id="tools-trigger" title="More tools">
          <svg width="14" height="6" viewBox="0 0 13 7" fill="currentColor">
          <circle cx="1" cy="3" r="1.5"/>
          <circle cx="7" cy="3" r="1.5"/>
          <circle cx="13" cy="3" r="1.5"/>
        </svg>
        </button>
        <div id="tools-menu">
          <button class="input-tool-btn t-btn tx3">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.44,11.05l-9.19,9.19a6,6,0,0,1-8.49-8.49l9.19-9.19a4,4,0,0,1,5.66,5.66l-9.2,9.19a2,2,0,0,1-2.83-2.83l8.49-8.48"/></svg>
            Attach file
          </button>
          <button class="input-tool-btn t-btn tx3" id="tool-flashcard" data-prompt="Generate flashcards for: ">
            ğŸƒ Generate flashcards
          </button>
          <button class="input-tool-btn t-btn tx3" id="tool-guide" data-prompt="Create a study guide for: ">
            ğŸ“– Create study guide
          </button>
        </div>
      </div>
      <textarea
        id="chat-input"
        class="chat-textarea tx bg-transparent"
        placeholder="Ask Korah anythingâ€¦ or tell me how you're feeling ğŸ§ "
        rows="2"
        style="min-height: 50px;"
      ></textarea>
      <button id="send-btn" class="send-btn grad-bg t-btn" aria-label="Send message">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <line x1="22" y1="2" x2="11" y2="13"/><polygon points="22,2 15,22 11,13 2,9"/>
        </svg>
      </button>
    </div>
    <div class="input-footer">
      <span class="text-[10px] tx3">Korah can make mistakes. Verify important information.</span>
      <span class="char-count text-[10px] tx3" id="char-count">0 / 2000</span>
    </div>
  </div>

</main>

<!-- Settings Modal -->
<div id="settings-modal" class="settings-modal">
  <div class="settings-modal-content">
    <div class="settings-header">
      <h2 class="settings-title">Settings</h2>
      <button class="settings-close" id="settings-close">&times;</button>
    </div>
    
    <div class="settings-body">
      <div class="settings-section">
        <h3 class="settings-section-title">Study Preferences</h3>
        
        <div class="setting-item">
          <label class="setting-label">Default Subject Mode</label>
          <select class="setting-select" id="setting-default-mode">
            <option value="math">Math Mode</option>
            <option value="physics" selected>Physics Mode</option>
            <option value="chemistry">Chemistry Mode</option>
            <option value="biology">Biology Mode</option>
            <option value="history">History Mode</option>
            <option value="literature">Literature Mode</option>
          </select>
        </div>
        
        <div class="setting-item">
          <label class="setting-label">Response Detail Level</label>
          <select class="setting-select" id="setting-detail-level">
            <option value="concise">Concise</option>
            <option value="detailed" selected>Detailed</option>
            <option value="comprehensive">Comprehensive</option>
          </select>
        </div>
        
        <div class="setting-item">
          <label class="setting-label">Auto Follow-up Suggestions</label>
          <div class="setting-toggle">
            <input type="checkbox" id="setting-auto-followup" checked>
            <label for="setting-auto-followup" class="toggle-label"></label>
          </div>
        </div>
        
        <div class="setting-item">
          <label class="setting-label">Focus Timer Default (minutes)</label>
          <input type="number" class="setting-input" id="setting-timer-default" value="25" min="5" max="60">
        </div>
      </div>
      
      <div class="settings-section">
        <h3 class="settings-section-title">Data Management</h3>
        
        <div class="setting-item">
          <button class="setting-action-btn export-btn" id="export-chats-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="7 10 12 15 17 10"/>
              <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
            Export All Chats
          </button>
        </div>
        
        <div class="setting-item">
          <button class="setting-action-btn clear-btn" id="clear-all-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="3 6 5 6 21 6"/>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
            </svg>
            Clear All Data
          </button>
        </div>
      </div>
    </div>
    
    <div class="settings-footer">
      <button class="settings-save-btn" id="settings-save-btn">Save Changes</button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js"></script>
<script src="korah-chat.js"></script>
</body>
</html>
